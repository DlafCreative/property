var fs = require('fs');
var path = require('path');
var express = require('express');
var bodyParser = require('body-parser');
var app = express();

var http = require('http');
var querystring = require('querystring');

var rickouest = require('request');

app.set('port', (process.env.PORT || 7000));

app.use('/', express.static(path.join(__dirname, '../dist')));
app.use('/client', express.static(path.join(__dirname, '../client')));
app.use('/node_modules', express.static(path.join(__dirname, '../node_modules')));

/**
 * @Todo : maybe need to disable this bodyParser option for authentication route, as it's not in json-api format
 */
app.use(bodyParser.json({ type: 'application/vnd.api+json' })); // Set to json-api format
//app.use(bodyParser.json()); 
app.use(bodyParser.urlencoded({extended: true}));

// Additional middleware which will set headers that we need on each request.
app.use(function(req, res, next) {
    // Set permissive CORS header - this allows this server to be used only as
    // an API server in conjunction with something like webpack-dev-server.
    res.setHeader('Access-Control-Allow-Origin', '*');

    // Also set permissive headers allowing to set any Content-Type
    res.setHeader('Access-Control-Allow-Headers', 'Content-Type,Accept,Authorization');

    // Disable caching so we'll always get the latest comments.
    res.setHeader('Cache-Control', 'no-cache');
    next();
});

/**
 * Routes
 */
// Login screen
app.get('/', function(req, res){
  res.sendFile(path.resolve('dist/index.html'));
});

/**
 * API 
 **/
app.post('/authenticate', function(req, res){

	// Formatting user params
	let username = `${req.body.customer_number}\\${req.body.username}`;
	let password = req.body.password;

	console.log(req.body);

	// Request needs querystring
	let postData = querystring.stringify({		
		client_id: '1_3g9z7wonyeck0wco00cgggoogcgk008gko0ow84ssoowsock0f',
		client_secret: '4zh7wm12w1wk8c8swccws0gosk8c0o8wcko0kcwoccg4k8o08f',
		username: username,
		password: password,
		grant_type: 'password'
	})

	// Add http.request options
	 let options = {
	 	host: 'api.property.local',
	 	path: '/app_dev.php/oauth/v2/token',
	 	method: 'POST',
	 	headers: {
			'Content-Type': 'application/x-www-form-urlencoded',	 		
	 		'Content-Length': Buffer.byteLength(postData)
	 	}
	 };

	 var request = http.request(options, function(httpResponse){
	 	var body = '';
	 	httpResponse.on('data', function(chunk){
	 		body += chunk;
	 	});
	 	httpResponse.on('end', function(){
	 		let parsedBody = JSON.parse(body);
	 		res.send(parsedBody);
	 	})
	 }).on('error', function(err){
	 	console.log(err);
	 });

	 // Write data
	 request.write(postData);

	 // End request 
	 request.end();

});

/**
 * Get claimfiles
 */
app.get('/claimfiles', function(req, res){	
	console.log('GET CLAIMFILES');
	let json = `{"data":[{"type":"claimFile","id":"FR08P00000054","attributes":{"wan":"FR08P00000054","wanType":"T","customerInformation":{"customerNumber":"00077269","customerName":"Dupont","customerAddressStreetNumber":"255","customerAddressAddressLine1":"Boulevard De L'Ocean","customerAddressAddressLine2":"","customerAddressAddressLine3":"","customerAddressZipCode":"33115","customerAddressCity":"Pyla-sur-Mer"},"contract":{"contractNumber":"2100122","insuranceCompanyName":"AXA FRANCE","typeOfContract":{"label":"Assurance habitation","value":""}},"claimInformation":{"claimNumber":"1","dateOfLoss":"2016-09-15","coverage":"TYPE_WATER_DAMAGE"},"descriptionOfRisk":{"typeOfProperty":{"label":"House","value":"HOUSE"},"numberOfRooms":"6","totalSize":"84"},"thirdParties":[{"type":"personal","uuid":"e3438b62-9b8f-11e6-bd24-525400c583ad","phoneCode":"33","additionalInformation":"nothing","thirdPartyRole":{"key":"ASSISTANCE_PROVIDER","name":"Assistance provider","type":"business"},"civility":"Mr","firstName":"ALAIN","lastName":"DUPONT","emailAddress":"email@person.com","mobilePhone":"06000000","phoneNumber":"01000000"},{"type":"business","uuid":"e44c59ef-9b8f-11e6-bd24-525400c583ad","phoneCode":"33","additionalInformation":"NOTHING","thirdPartyRole":{"key":"EXPERT","name":"Expert","type":"business"},"contactCivility":"Mrs","contactFirstName":"DANIELLE","contactLastName":"DUPONT","contactEmailAddress":"email@person.com","contactMobilePhone":"0600000000","companyName":"Sidexa","companyEmailAddress":"email@compagny.com","companyPhoneNumber":"0100000000","companyFax":"0100000000"}],"status":{"name":"PRE_NOTIFICATION_DONE","label":"Pre notification done","step":{"name":"REPORT_OPENING","label":"Report opening"}},"insurerExternalClaimFileId":"AXA1140812033A3","createdAt":"2016-09-15 12:50:00","updatedAt":"2016-09-15 12:50:00","closed":"0","closingDate":"","customer":"FR00000507I","customerOrigin":"FR00000507I","parent":null,"coverage":{"value":"TYPE_WATER_DAMAGE","label":"Water damage"},"breContext":null}},{"type":"claimFile","id":"FR19P00000050","attributes":{"wan":"FR19P00000050","wanType":"T","customerInformation":{"customerNumber":"00010587","customerName":"Dupont","customerAddressStreetNumber":"55","customerAddressAddressLine1":"Rue du Faubourg Saint-Honor√©","customerAddressAddressLine2":"","customerAddressAddressLine3":"","customerAddressZipCode":"75008","customerAddressCity":"Paris"},"contract":{"contractNumber":"5533701","insuranceCompanyName":"AXA FRANCE","typeOfContract":{"label":"Assurance habitation","value":""}},"claimInformation":{"claimNumber":"1","dateOfLoss":"2016-11-08","coverage":"TYPE_WATER_DAMAGE"},"descriptionOfRisk":{"typeOfProperty":{"label":"House","value":"HOUSE"},"numberOfRooms":"6","totalSize":"84"},"thirdParties":[{"type":"personal","uuid":"e3438b62-9b8f-11e6-bd24-525400c583ad","phoneCode":"33","additionalInformation":"nothing","thirdPartyRole":{"key":"ASSISTANCE_PROVIDER","name":"Assistance provider","type":"business"},"civility":"Mr","firstName":"ALAIN","lastName":"DUPONT","emailAddress":"email@person.com","mobilePhone":"06000000","phoneNumber":"01000000"},{"type":"business","uuid":"e44c59ef-9b8f-11e6-bd24-525400c583ad","phoneCode":"33","additionalInformation":"NOTHING","thirdPartyRole":{"key":"EXPERT","name":"Expert","type":"business"},"contactCivility":"Mrs","contactFirstName":"DANIELLE","contactLastName":"DUPONT","contactEmailAddress":"email@person.com","contactMobilePhone":"0600000000","companyName":"Sidexa","companyEmailAddress":"email@compagny.com","companyPhoneNumber":"0100000000","companyFax":"0100000000"}],"status":{"name":"PRE_NOTIFICATION_DONE","label":"Pre notification done","step":{"name":"REPORT_OPENING","label":"Report opening"}},"insurerExternalClaimFileId":"AXA2007133035A1","createdAt":"2016-11-08 17:32:00","updatedAt":"2016-11-08 17:32:00","closed":"0","closingDate":"","customer":"FR00000507I","customerOrigin":"FR00000507I","parent":null,"coverage":{"value":"TYPE_WATER_DAMAGE","label":"Water damage"},"breContext":null}},{"type":"claimFile","id":"FR27P00000003","attributes":{"wan":"FR27P00000003","wanType":"T","customerInformation":{"customerName":"Philippe","customerNumber":"00070604","customerAddressStreetNumber":"1","customerAddressAddressLine1":"Place Beauveau","customerAddressAddressLine2":"","customerAddressAddressLine3":"","customerAddressZipCode":"75008","customerAddressCity":"Paris"},"contract":{"contractNumber":"8100102","insuranceCompanyName":"AXA FRANCE","typeOfContract":{"label":"Assurance habitation","value":""}},"claimInformation":{"claimNumber":"3","dateOfLoss":"2016-11-25","coverage":"TYPE_FIRE"},"descriptionOfRisk":{"typeOfProperty":{"label":"House","value":"HOUSE"},"numberOfRooms":"2","totalSize":"45"},"thirdParties":[{"type":"personal","uuid":"cldk75d1-9b8f-11e6-bd24-0c1d23698erf","phoneCode":"33","additionalInformation":"nothing","thirdPartyRole":{"key":"PROFESSIONAL","name":"Professional","type":"personal"},"civility":"Mr","firstName":"NICOLAS","lastName":"LEBOIS","emailAddress":"email@person.com","mobilePhone":"06000000","phoneNumber":"01000000"},{"type":"business","uuid":"01ckdn78-5s7s-11e6-bd24-kfjrhty215v7","phoneCode":"33","additionalInformation":"NOTHING","thirdPartyRole":{"key":"BROKER","name":"Broker","type":"business"},"contactCivility":"Mr","contactFirstName":"JULIEN","contactLastName":"DEPPORTER","contactEmailAddress":"email@person.com","contactMobilePhone":"0600000000","companyName":"MATMUT","companyEmailAddress":"email@matmut.com","companyPhoneNumber":"0100000000","companyFax":"0100000000"}],"status":{"name":"PRE_NOTIFICATION_DONE","label":"Pre notification done","step":{"name":"REPORT_OPENING","label":"Report opening"}},"insurerExternalClaimFileId":"AXA8800812033A1","createdAt":"2016-11-25 11:53:00","updatedAt":"2016-11-25 11:53:00","closed":"0","closingDate":"","customer":"FR00000507I","customerOrigin":"FR00000507I","parent":null,"coverage":{"value":"TYPE_FIRE","label":"Fire"},"breContext":null}},{"type":"claimFile","id":"FR35P00000053","attributes":{"wan":"FR35P00000053","wanType":"T","customerInformation":{"customerNumber":"00012301","customerName":"LaForet","customerAddressStreetNumber":"20","customerAddressAddressLine1":"Rue Robert-Fossorier","customerAddressAddressLine2":"","customerAddressAddressLine3":"","customerAddressZipCode":"14800","customerAddressCity":"Deauville"},"contract":{"contractNumber":"3600155","insuranceCompanyName":"AXA FRANCE","typeOfContract":{"label":"Assurance habitation","value":""}},"claimInformation":{"claimNumber":"1","dateOfLoss":"2016-11-20","coverage":"TYPE_WATER_DAMAGE"},"descriptionOfRisk":{"typeOfProperty":{"label":"House","value":"HOUSE"},"numberOfRooms":"6","totalSize":"84"},"thirdParties":[{"type":"personal","uuid":"e3438b62-9b8f-11e6-bd24-525400c583ad","phoneCode":"33","additionalInformation":"nothing","thirdPartyRole":{"key":"ASSISTANCE_PROVIDER","name":"Assistance provider","type":"business"},"civility":"Mr","firstName":"ALAIN","lastName":"DUPONT","emailAddress":"email@person.com","mobilePhone":"06000000","phoneNumber":"01000000"},{"type":"business","uuid":"e44c59ef-9b8f-11e6-bd24-525400c583ad","phoneCode":"33","additionalInformation":"NOTHING","thirdPartyRole":{"key":"EXPERT","name":"Expert","type":"business"},"contactCivility":"Mrs","contactFirstName":"DANIELLE","contactLastName":"DUPONT","contactEmailAddress":"email@person.com","contactMobilePhone":"0600000000","companyName":"Sidexa","companyEmailAddress":"email@compagny.com","companyPhoneNumber":"0100000000","companyFax":"0100000000"}],"status":{"name":"PRE_NOTIFICATION_DONE","label":"Pre notification done","step":{"name":"REPORT_OPENING","label":"Report opening"}},"insurerExternalClaimFileId":"AXA1140812033A3","createdAt":"2016-11-20 09:18:00","updatedAt":"2016-11-20 09:18:00","closed":"0","closingDate":"","customer":"FR00000507I","customerOrigin":"FR00000507I","parent":null,"coverage":{"value":"TYPE_WATER_DAMAGE","label":"Water damage"},"breContext":null}},{"type":"claimFile","id":"FR51P00000056","attributes":{"wan":"FR51P00000056","wanType":"T","customerInformation":{"customerNumber":"00065203","customerName":"Loiseau","customerAddressStreetNumber":"9","customerAddressAddressLine1":"Place de la mairie","customerAddressAddressLine2":"","customerAddressAddressLine3":"","customerAddressZipCode":"35490","customerAddressCity":"Sens de Bretagne"},"contract":{"contractNumber":"1100212","insuranceCompanyName":"AXA FRANCE","typeOfContract":{"label":"Assurance habitation","value":""}},"claimInformation":{"claimNumber":"1","dateOfLoss":"2016-11-09","coverage":"TYPE_WATER_DAMAGE"},"descriptionOfRisk":{"typeOfProperty":{"label":"House","value":"HOUSE"},"numberOfRooms":"6","totalSize":"84"},"thirdParties":[{"type":"personal","uuid":"e3438b62-9b8f-11e6-bd24-525400c583ad","phoneCode":"33","additionalInformation":"nothing","thirdPartyRole":{"key":"ASSISTANCE_PROVIDER","name":"Assistance provider","type":"business"},"civility":"Mr","firstName":"ALAIN","lastName":"DUPONT","emailAddress":"email@person.com","mobilePhone":"06000000","phoneNumber":"01000000"},{"type":"business","uuid":"e44c59ef-9b8f-11e6-bd24-525400c583ad","phoneCode":"33","additionalInformation":"NOTHING","thirdPartyRole":{"key":"EXPERT","name":"Expert","type":"business"},"contactCivility":"Mrs","contactFirstName":"DANIELLE","contactLastName":"DUPONT","contactEmailAddress":"email@person.com","contactMobilePhone":"0600000000","companyName":"Sidexa","companyEmailAddress":"email@compagny.com","companyPhoneNumber":"0100000000","companyFax":"0100000000"}],"status":{"name":"PRE_NOTIFICATION_DONE","label":"Pre notification done","step":{"name":"REPORT_OPENING","label":"Report opening"}},"insurerExternalClaimFileId":"AXA2060702044A3","createdAt":"2016-11-09 10:14:00","updatedAt":"2016-11-09 10:14:00","closed":"0","closingDate":"","customer":"FR00000507I","customerOrigin":"FR00000507I","parent":null,"coverage":{"value":"TYPE_WATER_DAMAGE","label":"Water damage"},"breContext":null}},{"type":"claimFile","id":"FR62P00000052","attributes":{"wan":"FR62P00000052","wanType":"T","customerInformation":{"customerName":"Philippe","customerNumber":"00045102","customerAddressStreetNumber":"1","customerAddressAddressLine1":"Place Beauveau","customerAddressAddressLine2":"","customerAddressAddressLine3":"","customerAddressZipCode":"75008","customerAddressCity":"Paris"},"contract":{"contractNumber":"7001102","insuranceCompanyName":"AXA FRANCE","typeOfContract":{"label":"Assurance habitation","value":""}},"claimInformation":{"claimNumber":"3","dateOfLoss":"2016-11-25","coverage":"TYPE_FIRE","addressOfLossStreetNumber":"1","addressOfLossAddressLine1":"Place Beauveau","addressOfLossZipCode":"75008","addressOfLossCity":"Paris"},"descriptionOfRisk":{"typeOfProperty":{"label":"House","value":"HOUSE"},"numberOfRooms":"2","totalSize":"45"},"thirdParties":[{"type":"personal","uuid":"cldk75d1-9b8f-11e6-bd24-0c1d23698erf","phoneCode":"33","additionalInformation":"nothing","thirdPartyRole":{"key":"PROFESSIONAL","name":"Professional","type":"personal"},"civility":"Mr","firstName":"NICOLAS","lastName":"LEBOIS","emailAddress":"email@person.com","mobilePhone":"06000000","phoneNumber":"01000000"},{"type":"business","uuid":"01ckdn78-5s7s-11e6-bd24-kfjrhty215v7","phoneCode":"33","additionalInformation":"NOTHING","thirdPartyRole":{"key":"BROKER","name":"Broker","type":"business"},"contactCivility":"Mr","contactFirstName":"JULIEN","contactLastName":"DEPPORTER","contactEmailAddress":"email@person.com","contactMobilePhone":"0600000000","companyName":"MATMUT","companyEmailAddress":"email@matmut.com","companyPhoneNumber":"0100000000","companyFax":"0100000000"}],"status":{"name":"PRE_NOTIFICATION_DONE","label":"Pre notification done","step":{"name":"REPORT_OPENING","label":"Report opening"}},"insurerExternalClaimFileId":"AXA6000892010C1","createdAt":"2016-11-25 11:53:00","updatedAt":"2016-11-25 11:53:00","closed":"0","closingDate":"","customer":"FR00000507I","customerOrigin":"FR00000507I","parent":null,"coverage":{"value":"TYPE_FIRE","label":"Fire"},"breContext":null}},{"type":"claimFile","id":"FR78P00000055","attributes":{"wan":"FR78P00000055","wanType":"T","customerInformation":{"customerNumber":"00054001","customerName":"Carpentier","customerAddressStreetNumber":"84","customerAddressAddressLine1":"Rue Saint-Cath√©rine","customerAddressAddressLine2":"","customerAddressAddressLine3":"","customerAddressZipCode":"33970","customerAddressCity":"L√®ge-Cap-Ferret"},"contract":{"contractNumber":"4900155","insuranceCompanyName":"AXA FRANCE","typeOfContract":{"label":"Assurance habitation","value":""}},"claimInformation":{"claimNumber":"1","dateOfLoss":"2016-09-28","coverage":"TYPE_WATER_DAMAGE"},"descriptionOfRisk":{"typeOfProperty":{"label":"House","value":"HOUSE"},"numberOfRooms":"6","totalSize":"84"},"thirdParties":[{"type":"personal","uuid":"e3438b62-9b8f-11e6-bd24-525400c583ad","phoneCode":"33","additionalInformation":"nothing","thirdPartyRole":{"key":"ASSISTANCE_PROVIDER","name":"Assistance provider","type":"business"},"civility":"Mr","firstName":"ALAIN","lastName":"DUPONT","emailAddress":"email@person.com","mobilePhone":"06000000","phoneNumber":"01000000"},{"type":"business","uuid":"e44c59ef-9b8f-11e6-bd24-525400c583ad","phoneCode":"33","additionalInformation":"NOTHING","thirdPartyRole":{"key":"EXPERT","name":"Expert","type":"business"},"contactCivility":"Mrs","contactFirstName":"DANIELLE","contactLastName":"DUPONT","contactEmailAddress":"email@person.com","contactMobilePhone":"0600000000","companyName":"Sidexa","companyEmailAddress":"email@compagny.com","companyPhoneNumber":"0100000000","companyFax":"0100000000"}],"status":{"name":"PRE_NOTIFICATION_DONE","label":"Pre notification done","step":{"name":"REPORT_OPENING","label":"Report opening"}},"insurerExternalClaimFileId":"AXA5061012066A1","createdAt":"2016-09-28 14:21:00","updatedAt":"2016-09-28 14:21:00","closed":"0","closingDate":"","customer":"FR00000507I","customerOrigin":"FR00000507I","parent":null,"coverage":{"value":"TYPE_WATER_DAMAGE","label":"Water damage"},"breContext":null}},{"type":"claimFile","id":"FR83P00000062","attributes":{"wan":"FR83P00000062","wanType":"T","customerInformation":{"customerNumber":"00069008","customerName":"Breton","customerAddressStreetNumber":"5","customerAddressAddressLine1":"Rue de l'Hot√™l de ville","customerAddressAddressLine2":"","customerAddressAddressLine3":"","customerAddressZipCode":"06000","customerAddressCity":"Nice"},"contract":{"contractNumber":"7000255","insuranceCompanyName":"AXA FRANCE","typeOfContract":{"label":"Assurance habitation","value":""}},"claimInformation":{"claimNumber":"1","dateOfLoss":"2016-11-13","coverage":"TYPE_WATER_DAMAGE"},"descriptionOfRisk":{"typeOfProperty":{"label":"House","value":"HOUSE"},"numberOfRooms":"6","totalSize":"84"},"thirdParties":[{"type":"personal","uuid":"e3438b62-9b8f-11e6-bd24-525400c583ad","phoneCode":"33","additionalInformation":"nothing","thirdPartyRole":{"key":"ASSISTANCE_PROVIDER","name":"Assistance provider","type":"business"},"civility":"Mr","firstName":"ALAIN","lastName":"DUPONT","emailAddress":"email@person.com","mobilePhone":"06000000","phoneNumber":"01000000"},{"type":"business","uuid":"e44c59ef-9b8f-11e6-bd24-525400c583ad","phoneCode":"33","additionalInformation":"NOTHING","thirdPartyRole":{"key":"EXPERT","name":"Expert","type":"business"},"contactCivility":"Mrs","contactFirstName":"DANIELLE","contactLastName":"DUPONT","contactEmailAddress":"email@person.com","contactMobilePhone":"0600000000","companyName":"Sidexa","companyEmailAddress":"email@compagny.com","companyPhoneNumber":"0100000000","companyFax":"0100000000"}],"status":{"name":"PRE_NOTIFICATION_DONE","label":"Pre notification done","step":{"name":"REPORT_OPENING","label":"Report opening"}},"insurerExternalClaimFileId":"AXA6895000010A1","createdAt":"2016-11-13 09:20:00","updatedAt":"2016-11-13 09:20:00","closed":"0","closingDate":"","customer":"FR00000507I","customerOrigin":"FR00000507I","parent":null,"coverage":{"value":"TYPE_WATER_DAMAGE","label":"Water damage"},"breContext":null}},{"type":"claimFile","id":"FR89P00000051","attributes":{"wan":"FR89P00000051","wanType":"T","customerInformation":{"customerName":"Jean","customerNumber":"00020407","customerAddressStreetNumber":"130","customerAddressAddressLine1":"Avenue du g√©n√©ral leclerc","customerAddressAddressLine2":"","customerAddressAddressLine3":"","customerAddressZipCode":"92340","customerAddressCity":"Bourg la reine"},"contract":{"contractNumber":"8593701","insuranceCompanyName":"AXA FRANCE","typeOfContract":{"label":"Assurance habitation","value":""}},"claimInformation":{"claimNumber":"2","dateOfLoss":"2016-10-05","coverage":"TYPE_STORM"},"descriptionOfRisk":{"typeOfProperty":{"label":"House","value":"HOUSE"},"numberOfRooms":"2","totalSize":"45"},"thirdParties":[{"type":"personal","uuid":"s0045s50-9b8f-11e6-bd24-540400c542xs","phoneCode":"31","additionalInformation":"nothing","thirdPartyRole":{"key":"TENANT","name":"Tenant","type":"personal"},"civility":"Mr","firstName":"MARK","lastName":"DUPONT","emailAddress":"email@person.com","mobilePhone":"06000000","phoneNumber":"01000000"},{"type":"business","uuid":"5dld7fp4-5s7s-11e6-bd24-4fd8d7tnbg02","phoneCode":"31","additionalInformation":"NOTHING","thirdPartyRole":{"key":"EXPERT","name":"Expert","type":"business"},"contactCivility":"Mrs","contactFirstName":"JHON","contactLastName":"DUPONT","contactEmailAddress":"email@person.com","contactMobilePhone":"0600000000","companyName":"ABZ","companyEmailAddress":"email@abz.com","companyPhoneNumber":"0100000000","companyFax":"0100000000"}],"status":{"name":"PRE_NOTIFICATION_DONE","label":"Pre notification done","step":{"name":"REPORT_OPENING","label":"Report opening"}},"insurerExternalClaimFileId":"AXA4015133035A1","createdAt":"2016-10-05 11:00:00","updatedAt":"2016-10-05 11:00:00","closed":"0","closingDate":"","customer":"FR00000507I","customerOrigin":"FR00000507I","parent":null,"coverage":{"value":"TYPE_STORM","label":"Storm"},"breContext":null}}],"links":{"self":{"href":"/app_dev.php/claimFiles/v1/"}},"jsonapi":{"version":"1.0"}}`;

	let body = JSON.parse(json);
	res.send(body);
});

/**
 * Create claimfile. Return a new claimfile if successfull
 */
app.post('/claimfile', function(req, res){	

	let json = `{"data":{"type":"claimFile","id":"FR89P00000051","attributes":{"wan":"FR89P00000051","wanType":"T","customerInformation":{"customerName":"Jean","customerNumber":"00020407","customerAddressStreetNumber":"130","customerAddressAddressLine1":"Avenue du g√©n√©ral leclerc","customerAddressAddressLine2":"","customerAddressAddressLine3":"","customerAddressZipCode":"92340","customerAddressCity":"Bourg la reine"},"contract":{"contractNumber":"8593701","insuranceCompanyName":"AXA FRANCE","typeOfContract":{"label":"Assurance habitation","value":""}},"claimInformation":{"claimNumber":"2","dateOfLoss":"2016-10-05","coverage":"TYPE_STORM"},"descriptionOfRisk":{"typeOfProperty":{"label":"House","value":"HOUSE"},"numberOfRooms":"2","totalSize":"45"},"thirdParties":[{"type":"personal","uuid":"s0045s50-9b8f-11e6-bd24-540400c542xs","phoneCode":"31","additionalInformation":"nothing","thirdPartyRole":{"key":"TENANT","name":"Tenant","type":"personal"},"civility":"Mr","firstName":"MARK","lastName":"DUPONT","emailAddress":"email@person.com","mobilePhone":"06000000","phoneNumber":"01000000"},{"type":"business","uuid":"5dld7fp4-5s7s-11e6-bd24-4fd8d7tnbg02","phoneCode":"31","additionalInformation":"NOTHING","thirdPartyRole":{"key":"EXPERT","name":"Expert","type":"business"},"contactCivility":"Mrs","contactFirstName":"JHON","contactLastName":"DUPONT","contactEmailAddress":"email@person.com","contactMobilePhone":"0600000000","companyName":"ABZ","companyEmailAddress":"email@abz.com","companyPhoneNumber":"0100000000","companyFax":"0100000000"}],"status":{"name":"PRE_NOTIFICATION_DONE","label":"Pre notification done","step":{"name":"REPORT_OPENING","label":"Report opening"}},"insurerExternalClaimFileId":"AXA4015133035A1","createdAt":"2016-10-05 11:00:00","updatedAt":"2016-10-05 11:00:00","closed":"0","closingDate":"","customer":"FR00000507I","customerOrigin":"FR00000507I","parent":null,"coverage":{"value":"TYPE_STORM","label":"Storm"},"breContext":null}},"links":{"self":{"href":"/app_dev.php/claimFiles/v1/FR89P00000051"}},"jsonapi":{"version":"1.0"}}`;
	let body = JSON.parse(json)

	res.send(body);
});

/**
 * Get claimfile
 */
app.get('/claimfile/:id', function(req, res) {

	let json = `{"data":{"type":"claimFile","id":"FR89P00000051","attributes":{"wan":"FR89P00000051","wanType":"T","customerInformation":{"customerName":"Jean","customerNumber":"00020407","customerAddressStreetNumber":"130","customerAddressAddressLine1":"Avenue du g√©n√©ral leclerc","customerAddressAddressLine2":"","customerAddressAddressLine3":"","customerAddressZipCode":"92340","customerAddressCity":"Bourg la reine"},"contract":{"contractNumber":"8593701","insuranceCompanyName":"AXA FRANCE","typeOfContract":{"label":"Assurance habitation","value":""}},"claimInformation":{"claimNumber":"2","dateOfLoss":"2016-10-05","coverage":"TYPE_STORM"},"descriptionOfRisk":{"typeOfProperty":{"label":"House","value":"HOUSE"},"numberOfRooms":"2","totalSize":"45"},"thirdParties":[{"type":"personal","uuid":"s0045s50-9b8f-11e6-bd24-540400c542xs","phoneCode":"31","additionalInformation":"nothing","thirdPartyRole":{"key":"TENANT","name":"Tenant","type":"personal"},"civility":"Mr","firstName":"MARK","lastName":"DUPONT","emailAddress":"email@person.com","mobilePhone":"06000000","phoneNumber":"01000000"},{"type":"business","uuid":"5dld7fp4-5s7s-11e6-bd24-4fd8d7tnbg02","phoneCode":"31","additionalInformation":"NOTHING","thirdPartyRole":{"key":"EXPERT","name":"Expert","type":"business"},"contactCivility":"Mrs","contactFirstName":"JHON","contactLastName":"DUPONT","contactEmailAddress":"email@person.com","contactMobilePhone":"0600000000","companyName":"ABZ","companyEmailAddress":"email@abz.com","companyPhoneNumber":"0100000000","companyFax":"0100000000"}],"status":{"name":"PRE_NOTIFICATION_DONE","label":"Pre notification done","step":{"name":"REPORT_OPENING","label":"Report opening"}},"insurerExternalClaimFileId":"AXA4015133035A1","createdAt":"2016-10-05 11:00:00","updatedAt":"2016-10-05 11:00:00","closed":"0","closingDate":"","customer":"FR00000507I","customerOrigin":"FR00000507I","parent":null,"coverage":{"value":"TYPE_STORM","label":"Storm"},"breContext":null}},"links":{"self":{"href":"/app_dev.php/claimFiles/v1/FR89P00000051"}},"jsonapi":{"version":"1.0"}}`;
	let body = JSON.parse(json)

	res.send(body);
});

/**
 * Submit form part // @todo : bring get form-metadata here, same final uri, almost same logic.
 */
app.all('/form-part/:claimFileId/:context', (req, res) => {

	// Response for the preflight 
	if (req.method === 'OPTIONS') {
		res.end();
	}
	else {

		var json;

		// Form part submission returns a complete updated claimfile
		if (req.method === 'POST') {
			json = `{"data":{"type":"claimFile","id":"FR54P00000002","attributes":{"wan":"FR54P00000002","wanType":"T","customerInformation":{"customerName":"Jean","customerNumber":"201"},"contract":{"contractNumber":"201"},"claimInformation":{"claimNumber":"2","dateOfLoss":"2016-01-01 08:00:00","coverage":"TYPE_STORM"},"descriptionOfRisk":{"typeOfProperty":"apartment","numberOfRooms":"2","totalSize":"45"},"thirdParties":[{"type":"personal","uuid":"s0045s50-9b8f-11e6-bd24-540400c542xs","phoneCode":"31","additionalInformation":"nothing","thirdPartyRole":{"key":"TENANT","name":"Tenant","type":"personal"},"civility":"Mr","firstName":"MARK","lastName":"DUPONT","emailAddress":"email@person.com","mobilePhone":"06000000","phoneNumber":"01000000"},{"type":"business","uuid":"5dld7fp4-5s7s-11e6-bd24-4fd8d7tnbg02","phoneCode":"31","additionalInformation":"NOTHING","thirdPartyRole":{"key":"EXPERT","name":"Expert","type":"business"},"contactCivility":"Mrs","contactFirstName":"JHON","contactLastName":"DUPONT","contactEmailAddress":"email@person.com","contactMobilePhone":"0600000000","companyName":"ABZ","companyEmailAddress":"email@abz.com","companyPhoneNumber":"0100000000","companyFax":"0100000000"}],"status":{"name":"VALIDATE_CONTRACT","label":"Validate contract","step":{"name":"VALIDATE_CONTRACT","label":"Validate contract"}},"insurerExternalClaimFileId":"201","createdAt":"2016-01-01 08:00:00","updatedAt":"2016-01-01 08:00:00","closed":"0","closingDate":"","customer":"FR0001","customerOrigin":"FR0001","parent":null,"breContext":{"uuid":"59eb67bb-b26d-11e6-9d19-525400bd971e","name":"Sidexa - Storm","coverage":{"type":"TYPE_STORM","name":"Storm"},"rank":3,"maxContentAmount":10000,"maxDamageAmount":15000,"maxAmount":100000,"maxEmbellishmentAmount":16000,"lifeCycles":[{"uuid":"76ade7a1-b26d-11e6-9d19-525400bd971e","stepName":"REPORT_OPENING","services":[{"id":"VIEW_CLAIM_FILE","createdAt":"2016-11-24T17:42:16+0000","label":"Open claim file"},{"id":"UPDATE_CLAIM_FILE","createdAt":"2016-11-24T17:42:16+0000","label":"Update claim file"},{"id":"ADD_SUPPORTING_DOCS","createdAt":"2016-11-24T17:42:16+0000","label":"Add supporting documents"},{"id":"SEND_MESSAGE","createdAt":"2016-11-24T17:42:16+0000","label":"Send a message"},{"id":"ADD_THIRD_PARTY","createdAt":"2016-11-24T17:42:16+0000","label":"Add third party"},{"id":"AUTO_EVALUATE","createdAt":"2016-11-24T17:42:16+0000","label":"Auto evaluate the damages"},{"id":"COVERAGE_CHECKING","createdAt":"2016-11-24T17:42:16+0000","label":"Coverage checking"},{"id":"TREAT_RECEIVED_MISSION","createdAt":"2016-11-24T17:42:16+0000","label":"Manage assignment"}]},{"uuid":"76ae2379-b26d-11e6-9d19-525400bd971e","stepName":"VALIDATE_CONTRACT","services":[{"id":"VIEW_CLAIM_FILE","createdAt":"2016-11-24T17:42:16+0000","label":"Open claim file"},{"id":"UPDATE_CLAIM_FILE","createdAt":"2016-11-24T17:42:16+0000","label":"Update claim file"},{"id":"ADD_SUPPORTING_DOCS","createdAt":"2016-11-24T17:42:16+0000","label":"Add supporting documents"},{"id":"SEND_MESSAGE","createdAt":"2016-11-24T17:42:16+0000","label":"Send a message"},{"id":"ADD_THIRD_PARTY","createdAt":"2016-11-24T17:42:16+0000","label":"Add third party"},{"id":"AUTO_EVALUATE","createdAt":"2016-11-24T17:42:16+0000","label":"Auto evaluate the damages"},{"id":"COVERAGE_CHECKING","createdAt":"2016-11-24T17:42:16+0000","label":"Coverage checking"},{"id":"TREAT_RECEIVED_MISSION","createdAt":"2016-11-24T17:42:16+0000","label":"Manage assignment"}]},{"uuid":"76ae595e-b26d-11e6-9d19-525400bd971e","stepName":"COVERAGE_CHECKING","services":[{"id":"VIEW_CLAIM_FILE","createdAt":"2016-11-24T17:42:16+0000","label":"Open claim file"},{"id":"UPDATE_CLAIM_FILE","createdAt":"2016-11-24T17:42:16+0000","label":"Update claim file"},{"id":"ADD_SUPPORTING_DOCS","createdAt":"2016-11-24T17:42:16+0000","label":"Add supporting documents"},{"id":"SEND_MESSAGE","createdAt":"2016-11-24T17:42:16+0000","label":"Send a message"},{"id":"ADD_THIRD_PARTY","createdAt":"2016-11-24T17:42:16+0000","label":"Add third party"},{"id":"AUTO_EVALUATE","createdAt":"2016-11-24T17:42:16+0000","label":"Auto evaluate the damages"},{"id":"COVERAGE_CHECKING","createdAt":"2016-11-24T17:42:16+0000","label":"Coverage checking"},{"id":"TREAT_RECEIVED_MISSION","createdAt":"2016-11-24T17:42:16+0000","label":"Manage assignment"}]},{"uuid":"76ae8938-b26d-11e6-9d19-525400bd971e","stepName":"DAMAGE_EVALUATION","services":[{"id":"VIEW_CLAIM_FILE","createdAt":"2016-11-24T17:42:16+0000","label":"Open claim file"},{"id":"UPDATE_CLAIM_FILE","createdAt":"2016-11-24T17:42:16+0000","label":"Update claim file"},{"id":"ADD_SUPPORTING_DOCS","createdAt":"2016-11-24T17:42:16+0000","label":"Add supporting documents"},{"id":"SEND_MESSAGE","createdAt":"2016-11-24T17:42:16+0000","label":"Send a message"},{"id":"ADD_THIRD_PARTY","createdAt":"2016-11-24T17:42:16+0000","label":"Add third party"},{"id":"AUTO_EVALUATE","createdAt":"2016-11-24T17:42:16+0000","label":"Auto evaluate the damages"},{"id":"COVERAGE_CHECKING","createdAt":"2016-11-24T17:42:16+0000","label":"Coverage checking"},{"id":"TREAT_RECEIVED_MISSION","createdAt":"2016-11-24T17:42:16+0000","label":"Manage assignment"}]},{"uuid":"76aeb326-b26d-11e6-9d19-525400bd971e","stepName":"INDEMNITIES_CALCULATE","services":[{"id":"VIEW_CLAIM_FILE","createdAt":"2016-11-24T17:42:16+0000","label":"Open claim file"},{"id":"UPDATE_CLAIM_FILE","createdAt":"2016-11-24T17:42:16+0000","label":"Update claim file"},{"id":"ADD_SUPPORTING_DOCS","createdAt":"2016-11-24T17:42:16+0000","label":"Add supporting documents"},{"id":"SEND_MESSAGE","createdAt":"2016-11-24T17:42:16+0000","label":"Send a message"},{"id":"ADD_THIRD_PARTY","createdAt":"2016-11-24T17:42:16+0000","label":"Add third party"},{"id":"AUTO_EVALUATE","createdAt":"2016-11-24T17:42:16+0000","label":"Auto evaluate the damages"},{"id":"COVERAGE_CHECKING","createdAt":"2016-11-24T17:42:16+0000","label":"Coverage checking"},{"id":"TREAT_RECEIVED_MISSION","createdAt":"2016-11-24T17:42:16+0000","label":"Manage assignment"}]},{"uuid":"76aeec2d-b26d-11e6-9d19-525400bd971e","stepName":"REPAIR","services":[{"id":"VIEW_CLAIM_FILE","createdAt":"2016-11-24T17:42:16+0000","label":"Open claim file"},{"id":"UPDATE_CLAIM_FILE","createdAt":"2016-11-24T17:42:16+0000","label":"Update claim file"},{"id":"ADD_SUPPORTING_DOCS","createdAt":"2016-11-24T17:42:16+0000","label":"Add supporting documents"},{"id":"SEND_MESSAGE","createdAt":"2016-11-24T17:42:16+0000","label":"Send a message"},{"id":"ADD_THIRD_PARTY","createdAt":"2016-11-24T17:42:16+0000","label":"Add third party"},{"id":"AUTO_EVALUATE","createdAt":"2016-11-24T17:42:16+0000","label":"Auto evaluate the damages"},{"id":"COVERAGE_CHECKING","createdAt":"2016-11-24T17:42:16+0000","label":"Coverage checking"},{"id":"TREAT_RECEIVED_MISSION","createdAt":"2016-11-24T17:42:16+0000","label":"Manage assignment"}]},{"uuid":"76af24c6-b26d-11e6-9d19-525400bd971e","stepName":"EXPERTISE","services":[{"id":"VIEW_CLAIM_FILE","createdAt":"2016-11-24T17:42:16+0000","label":"Open claim file"},{"id":"UPDATE_CLAIM_FILE","createdAt":"2016-11-24T17:42:16+0000","label":"Update claim file"},{"id":"ADD_SUPPORTING_DOCS","createdAt":"2016-11-24T17:42:16+0000","label":"Add supporting documents"},{"id":"SEND_MESSAGE","createdAt":"2016-11-24T17:42:16+0000","label":"Send a message"},{"id":"ADD_THIRD_PARTY","createdAt":"2016-11-24T17:42:16+0000","label":"Add third party"},{"id":"AUTO_EVALUATE","createdAt":"2016-11-24T17:42:16+0000","label":"Auto evaluate the damages"},{"id":"COVERAGE_CHECKING","createdAt":"2016-11-24T17:42:16+0000","label":"Coverage checking"},{"id":"TREAT_RECEIVED_MISSION","createdAt":"2016-11-24T17:42:16+0000","label":"Manage assignment"}]},{"uuid":"76af60d8-b26d-11e6-9d19-525400bd971e","stepName":"LOSS_SETTLEMENT","services":null},{"uuid":"76af91f8-b26d-11e6-9d19-525400bd971e","stepName":"CLOSING","services":[{"id":"VIEW_CLAIM_FILE","createdAt":"2016-11-24T17:42:16+0000","label":"Open claim file"},{"id":"UPDATE_CLAIM_FILE","createdAt":"2016-11-24T17:42:16+0000","label":"Update claim file"},{"id":"ADD_SUPPORTING_DOCS","createdAt":"2016-11-24T17:42:16+0000","label":"Add supporting documents"},{"id":"SEND_MESSAGE","createdAt":"2016-11-24T17:42:16+0000","label":"Send a message"},{"id":"ADD_THIRD_PARTY","createdAt":"2016-11-24T17:42:16+0000","label":"Add third party"},{"id":"AUTO_EVALUATE","createdAt":"2016-11-24T17:42:16+0000","label":"Auto evaluate the damages"},{"id":"COVERAGE_CHECKING","createdAt":"2016-11-24T17:42:16+0000","label":"Coverage checking"},{"id":"TREAT_RECEIVED_MISSION","createdAt":"2016-11-24T17:42:16+0000","label":"Manage assignment"}]}]}}},"links":{"self":{"href":"/app_dev.php/claimFiles/v1/FR54P00000002"}},"jsonapi":{"version":"1.0"}}`;
		}
		/**
		 * Return unique part (customerInformation)
		 */
		else if (req.method === 'GET') {

			const formData = {
				CustomerInformation: `{"data":[{"type":"Reference","attributes":{"name":"Reference","fields":[{"id":"70443168-b26d-11e6-9d19-525400bd971e","name":"customerNumber","label":"Customer's number","type":"text","text":"Customer's number","path":"ClaimFile.CustomerInformation.customerNumber","value":"201","minLength":"2","maxLength":"20","choices":null,"mandatory":true,"rank":1},{"id":"704486b4-b26d-11e6-9d19-525400bd971e","name":"customerReference","label":"Customer's reference","type":"text","text":"Customer's reference","path":"ClaimFile.CustomerInformation.customerReference","value":null,"minLength":"2","maxLength":"20","choices":null,"mandatory":true,"rank":2},{"id":"7044f59a-b26d-11e6-9d19-525400bd971e","name":"customerName","label":"Customer's name","type":"text","text":"Customer's name","path":"ClaimFile.CustomerInformation.customerName","value":"Jean","minLength":"2","maxLength":"32","choices":null,"mandatory":true,"rank":3},{"id":"704568d3-b26d-11e6-9d19-525400bd971e","name":"typeOfInsured","label":"Type of insured","type":"dropdown","text":"Type of insured","path":"ClaimFile.CustomerInformation.typeOfInsured","value":null,"minLength":null,"maxLength":null,"choices":{"OWNER_OCCUPIED":"An owner occupied (or personal homeowner)","NON_OWNER_OCCUPIED":"A non-owner occupied","CO_OWNER_OCCUPIED":"A co-owner-occupied (or Condo))","NON_CO_OWNER_OCCUPIED":"A non co-owner occupied","TENANT_OCCUPANCY":"A tenant occupancy","NON_OCCUPANT":"A tenant given the day off (non-occupant)"},"mandatory":true,"rank":4}]}},{"type":"Contact","attributes":{"name":"Contact","fields":[{"id":"7045f669-b26d-11e6-9d19-525400bd971e","name":"streetNumber","label":"Street number","type":"text","text":"Street number","path":"ClaimFile.CustomerInformation.streetNumber","value":null,"minLength":null,"maxLength":"5","choices":null,"mandatory":true,"rank":1},{"id":"70467489-b26d-11e6-9d19-525400bd971e","name":"address1","label":"Address 1","type":"text","text":"Address 1","path":"ClaimFile.CustomerInformation.address1","value":null,"minLength":null,"maxLength":"38","choices":null,"mandatory":true,"rank":1},{"id":"7046fbf6-b26d-11e6-9d19-525400bd971e","name":"address2","label":"Address 2","type":"text","text":"Address 2","path":"ClaimFile.CustomerInformation.address2","value":null,"minLength":null,"maxLength":"38","choices":null,"mandatory":true,"rank":1},{"id":"70478b99-b26d-11e6-9d19-525400bd971e","name":"address3","label":"Address 3","type":"text","text":"Address 3","path":"ClaimFile.CustomerInformation.address3","value":null,"minLength":null,"maxLength":"38","choices":null,"mandatory":true,"rank":1},{"id":"70481984-b26d-11e6-9d19-525400bd971e","name":"zipCode","label":"Zip code","type":"text","text":"Zip code","path":"ClaimFile.CustomerInformation.zipCode","value":null,"minLength":null,"maxLength":"6","choices":null,"mandatory":true,"rank":1},{"id":"7048ac49-b26d-11e6-9d19-525400bd971e","name":"city","label":"City","type":"text","text":"City","path":"ClaimFile.CustomerInformation.city","value":null,"minLength":null,"maxLength":"30","choices":null,"mandatory":true,"rank":1},{"id":"704947f3-b26d-11e6-9d19-525400bd971e","name":"email","label":"Email address","type":"email","text":"Email address","path":"ClaimFile.CustomerInformation.email","value":null,"minLength":null,"maxLength":"15","choices":null,"mandatory":true,"rank":2},{"id":"7049e9a7-b26d-11e6-9d19-525400bd971e","name":"phoneNumber","label":"Phone number","type":"integer","text":"Phone number","path":"ClaimFile.CustomerInformation.phoneNumber","value":null,"minLength":null,"maxLength":"15","choices":null,"mandatory":true,"rank":3},{"id":"704a9277-b26d-11e6-9d19-525400bd971e","name":"communicationChannel","label":"Communication channel","type":"dropdown","text":"Communication channel","path":"ClaimFile.CustomerInformation.communicationChannel","value":null,"minLength":null,"maxLength":"2","choices":{"1":"internet","2":"phone","3":"sms"},"mandatory":true,"rank":4}]}}],"links":{"self":{"href":"/app_dev.php/forms/v1/claimFile/FR54P00000002/CustomerInformation"}},"jsonapi":{"version":"1.0"}}`,
				ClaimInformation: `{"data":[{"type":"Reference","attributes":{"name":"Reference","fields":[{"id":"9b531a5e-b0d4-11e6-857d-5254007c4f9a","name":"soleraClaimNumber","label":"Solera claim file number","type":"integer","text":"Solera claim file number","path":"ClaimFile.ClaimInformation.soleraClaimNumber","value":"","minLength":null,"maxLength":"11","choices":null,"mandatory":null,"rank":1},{"id":"9b55f506-b0d4-11e6-857d-5254007c4f9a","name":"claimNumber","label":"Claim's number (create in IT system)","type":"integer","text":"Claim's number (create in IT system)","path":"ClaimFile.ClaimInformation.claimNumber","value":"1","minLength":null,"maxLength":"11","choices":null,"mandatory":null,"rank":2}]}},{"type":"Status","attributes":{"name":"Status","fields":[{"id":"9b5452e1-b0d4-11e6-857d-5254007c4f9a","name":"eventType","label":"Event type","type":"dropdown","text":"Event type","path":"ClaimFile.ClaimInformation.eventType","value":"THEFT","minLength":null,"maxLength":null,"choices":{"UNKNOWN_FIRE":"Unknown fire","FIRE_HUMAN_INTERVENATION":"Fire - Human intervention","FIRE_ELECTRICAL_INSTALLATION":"Fire - Electrical installation","FIRE_HOME_ACCESSORY":"Fire - Home accessory","FIRE_VANDALISM_EXPLOSION":"Fire - Vandalism - Explosion","FIRE_NATURAL_EVENT":"Fire - Natural event","LEAK_PIPE_RUPTURE":"Leak - Pipe rupture","INFILTRATION":"Infitration","OVERTHROW":"Overthrow","THEFT_BREAKING_IN":"Theft - Breaking in","THEFT_WITHOUT_BREAKING_IN":"Theft - Without Breaking in","THEFT":"Theft","ACCIDENTAL":"Accidental"},"mandatory":true,"rank":1},{"id":"9b579378-b0d4-11e6-857d-5254007c4f9a","name":"dateOfLoss","label":"Date of loss","type":"date","text":"Date of loss","path":"ClaimFile.ClaimInformation.dateOfLoss","value":"2014-01-01","minLength":null,"maxLength":null,"choices":null,"mandatory":true,"rank":2},{"id":"9b594dbd-b0d4-11e6-857d-5254007c4f9a","name":"declarationDate","label":"Declaration date","type":"date","text":"Declaration date","path":"ClaimFile.ClaimInformation.declarationDate","value":"2014-01-01","minLength":null,"maxLength":null,"choices":null,"mandatory":true,"rank":3},{"id":"9b5b4d7c-b0d4-11e6-857d-5254007c4f9a","name":"lastStatusOfClaim","label":"Last status of claim","type":"text","text":"Last status of claim","path":"ClaimFile.ClaimInformation.lastStatusOfClaim","value":"ok","minLength":null,"maxLength":null,"choices":null,"mandatory":true,"rank":4}]}},{"type":"Coverage","attributes":{"name":"Coverage","fields":[{"id":"9b5d99be-b0d4-11e6-857d-5254007c4f9a","name":"coverage","label":"Coverage","type":"entity","text":"Coverage","path":"ClaimFile.ClaimInformation.coverage","value":"TYPE_FIRE","minLength":null,"maxLength":null,"choices":{"TYPE_ELECTRICAL_DAMAGE":"Electrical damage","TYPE_FIRE":"Fire","TYPE_FROST":"Frost","TYPE_GLASS_BREAKAGE":"Glass breakage","TYPE_HAIL":"Hail","TYPE_HIT_BY_GROUND_VEHICULE":"Hit by ground vehicule","TYPE_MACHINE_BREAKING":"Machine breaking","TYPE_NATURAL_DISASTER":"Natural disaster","TYPE_STORM":"Storm","TYPE_THEFT":"Theft","TYPE_VANDALISM":"Vandalism","TYPE_WATER_DAMAGE":"Water damage"},"mandatory":true,"rank":1},{"id":"9b5fb25e-b0d4-11e6-857d-5254007c4f9a","name":"addressOfLoss","label":"Address of loss","type":"text","text":"Address of loss","path":"ClaimFile.ClaimInformation.addressOfLoss","value":"ok","minLength":null,"maxLength":"10","choices":null,"mandatory":true,"rank":2},{"id":"9b61fccd-b0d4-11e6-857d-5254007c4f9a","name":"zipCodeOfLoss","label":"  of loss","type":"text","text":"  of loss","path":"ClaimFile.ClaimInformation.zipCodeOfLoss","value":"ok","minLength":null,"maxLength":"10","choices":null,"mandatory":true,"rank":2},{"id":"9b64512d-b0d4-11e6-857d-5254007c4f9a","name":"townOfLoss","label":"Town of loss","type":"text","text":"Town of loss","path":"ClaimFile.ClaimInformation.townOfLoss","value":"ok","minLength":null,"maxLength":"10","choices":null,"mandatory":true,"rank":2},{"id":"9b66a891-b0d4-11e6-857d-5254007c4f9a","name":"descriptionOfDamage","label":"Description of damage","type":"text_area","text":"Description of damage","path":"ClaimFile.ClaimInformation.descriptionOfDamage","value":"ok","minLength":null,"maxLength":"80","choices":null,"mandatory":true,"rank":3}]}},{"type":"Risk","attributes":{"name":"Risk","fields":[{"id":"9b696539-b0d4-11e6-857d-5254007c4f9a","name":"damageType","label":"Damage type/category","type":"dropdown","text":"Damage type/category","path":"ClaimFile.ClaimInformation.damageType","value":"PROPERTY","minLength":null,"maxLength":null,"choices":{"PROPERTY":"Property","MOVABLE_PROPERTY":"Movable Property"},"mandatory":true,"rank":1}]}}],"links":{"self":{"href":"/app_dev.php/forms/v1/claimFile/FR70P90000000/ClaimInformation?access_token=Y2Y0YjdkZjA3OGFmOWIwZjQ2YTdhNjcyMmQzZTczNjkzY2ZkYzFjMDQ3NDBmZWI3YmIxMDczM2U3MDZkNTE3Nw"}},"jsonapi":{"version":"1.0"}}`,
				Contract: `{"data":[{"type":"Reference","attributes":{"name":"Reference","fields":[{"id":"92834af7-b0d4-11e6-857d-5254007c4f9a","name":"typeOfContract","label":"Type of contract","type":"dropdown","text":"Type of contract","path":"ClaimFile.Contract.typeOfContract","value":null,"minLength":null,"maxLength":null,"choices":{"MRH":"MRH","MRP":"MRP","MRI":"MRI","MRA":"MRA"},"mandatory":true,"rank":1},{"id":"92851bc0-b0d4-11e6-857d-5254007c4f9a","name":"policySituation","label":"Policy situation","type":"dropdown","text":"Policy situation","path":"ClaimFile.Contract.policySituation","value":null,"minLength":null,"maxLength":null,"choices":{"NEW":"New","REPLACE":"Replace","IN_PROGRESS":"In Progress","GIVEN_NOTICE":"Given notice","CLOSED":"Closed","PROJECT":"Project"},"mandatory":null,"rank":3},{"id":"9287ae6a-b0d4-11e6-857d-5254007c4f9a","name":"contractNumber","label":"Contract's number","type":"integer","text":"Contract's number","path":"ClaimFile.Contract.contractNumber","value":"101","minLength":null,"maxLength":"17","choices":null,"mandatory":true,"rank":4}]}},{"type":"Status","attributes":{"name":"Status","fields":[{"id":"928a6b4e-b0d4-11e6-857d-5254007c4f9a","name":"statusOfContract","label":"Status of contract","type":"dropdown","text":"Status of contract","path":"ClaimFile.Contract.statusOfContract","value":null,"minLength":null,"maxLength":null,"choices":{"IN_PROGRESS":"In Progress","GIVEN_NOTICE":"Given notice","CLOSED":"Closed","PROJECT":"Project"},"mandatory":true,"rank":1},{"id":"928cf49f-b0d4-11e6-857d-5254007c4f9a","name":"effectiveDate","label":"Effective date","type":"date","text":"Effective date","path":"ClaimFile.Contract.effectiveDate","value":null,"minLength":null,"maxLength":null,"choices":null,"mandatory":true,"rank":2}]}},{"type":"Risk","attributes":{"name":"Risk","fields":[{"id":"928fe3d6-b0d4-11e6-857d-5254007c4f9a","name":"typeOfProperty","label":"Type of property","type":"dropdown","text":"Type of property","path":"ClaimFile.Contract.typeOfProperty","value":null,"minLength":null,"maxLength":null,"choices":{"HOUSE":"House","FLAT":"Flat"},"mandatory":true,"rank":1}]}}],"links":{"self":{"href":"/app_dev.php/forms/v1/claimFile/FR70P90000000/Contract?access_token=Y2Y0YjdkZjA3OGFmOWIwZjQ2YTdhNjcyMmQzZTczNjkzY2ZkYzFjMDQ3NDBmZWI3YmIxMDczM2U3MDZkNTE3Nw"}},"jsonapi":{"version":"1.0"}}`,
				DescriptionOfRisk: `{"data":[{"type":"Risk","attributes":{"name":"Risk","fields":[{"id":"7ce64b49-b0d4-11e6-857d-5254007c4f9a","name":"typeOfProperty","label":"Type of property","type":"dropdown","text":"Type of property","path":"ClaimFile.DescriptionOfRisk.typeOfProperty","value":"House","minLength":null,"maxLength":null,"choices":{"HOUSE":"House","FLAT":"Flat"},"mandatory":true,"rank":1},{"id":"7ce7eb05-b0d4-11e6-857d-5254007c4f9a","name":"numberOfRooms","label":"Number of rooms","type":"integer","text":"Number of rooms","path":"ClaimFile.DescriptionOfRisk.numberOfRooms","value":"6","minLength":null,"maxLength":"3","choices":null,"mandatory":true,"rank":2},{"id":"7cea379a-b0d4-11e6-857d-5254007c4f9a","name":"totalSize","label":"Total size","type":"text","text":"Total size","path":"ClaimFile.DescriptionOfRisk.totalSize","value":"84","minLength":null,"maxLength":"6","choices":null,"mandatory":true,"rank":3},{"id":"7ced164f-b0d4-11e6-857d-5254007c4f9a","name":"ageOfHousing","label":"Age of housing","type":"text","text":"Age of housing","path":"ClaimFile.DescriptionOfRisk.ageOfHousing","value":null,"minLength":null,"maxLength":"10","choices":null,"mandatory":true,"rank":4}]}}],"links":{"self":{"href":"/app_dev.php/forms/v1/claimFile/FR70P90000000/DescriptionOfRisk?access_token=Y2Y0YjdkZjA3OGFmOWIwZjQ2YTdhNjcyMmQzZTczNjkzY2ZkYzFjMDQ3NDBmZWI3YmIxMDczM2U3MDZkNTE3Nw"}},"jsonapi":{"version":"1.0"}}`
			};
			
			json = formData[req.params.context];
		}		

		let body = JSON.parse(json);
		res.send(body);
	}

});

/**
 * Get list of coverages
 */
app.get('/coverages', (req, res) => {
	let json = `{"meta":{"total_count":12},"data":[{"type":"coverage","attributes":{"type":"TYPE_WATER_DAMAGE","name":"Water damage","rank":1}},{"type":"coverage","attributes":{"type":"TYPE_THEFT","name":"Theft","rank":2}},{"type":"coverage","attributes":{"type":"TYPE_ELECTRICAL_DAMAGE","name":"Electrical damage","rank":3}},{"type":"coverage","attributes":{"type":"TYPE_GLASS_BREAKAGE","name":"Glass breakage","rank":4}},{"type":"coverage","attributes":{"type":"TYPE_FIRE","name":"Fire","rank":5}},{"type":"coverage","attributes":{"type":"TYPE_FROST","name":"Frost","rank":6}},{"type":"coverage","attributes":{"type":"TYPE_STORM","name":"Storm","rank":7}},{"type":"coverage","attributes":{"type":"TYPE_HAIL","name":"Hail","rank":8}},{"type":"coverage","attributes":{"type":"TYPE_HIT_BY_GROUND_VEHICULE","name":"Hit by ground vehicule","rank":9}},{"type":"coverage","attributes":{"type":"TYPE_MACHINE_BREAKING","name":"Machine breaking","rank":10}},{"type":"coverage","attributes":{"type":"TYPE_VANDALISM","name":"Vandalism","rank":11}},{"type":"coverage","attributes":{"type":"TYPE_NATURAL_DISASTER","name":"Natural disaster","rank":12}}],"links":{"self":"\/app_dev.php\/coverages\/v1\/?access_token=Yzg3YTdjZDcxNThjMTRmNzkwZDYxOGEyZmM2NTFhODVhZjM1NTMyMjRhYzY5OTFmOTM4ZjMxMmEyYzg2NzdmOQ","first":"\/app_dev.php\/coverages\/v1\/?page[number]=1","prev":null,"next":"\/app_dev.php\/coverages\/v1\/?page[number]=1","last":"\/app_dev.php\/coverages\/v1\/?page[number]=12"},"jsonapi":{"version":"1.0"}}`;

	let body = JSON.parse(json);

	res.send(body);
});

/**
 * Get steps
 */
app.get('/steps', (req, res) => {	
	let json = `{"data":[{"type":"step","id":"REPORT_OPENING","attributes":{"id":"REPORT_OPENING","name":"REPORT_OPENING","label":"Report opening","rank":1}},{"type":"step","id":"VALIDATE_CONTRACT","attributes":{"id":"VALIDATE_CONTRACT","name":"VALIDATE_CONTRACT","label":"Validate contract","rank":2}},{"type":"step","id":"COVERAGE_CHECKING","attributes":{"id":"COVERAGE_CHECKING","name":"COVERAGE_CHECKING","label":"Coverage checking","rank":3}},{"type":"step","id":"DAMAGE_EVALUATION","attributes":{"id":"DAMAGE_EVALUATION","name":"DAMAGE_EVALUATION","label":"Damage evaluation","rank":4}},{"type":"step","id":"INDEMNITIES_CALCULATE","attributes":{"id":"INDEMNITIES_CALCULATE","name":"INDEMNITIES_CALCULATE","label":"Indemnities calculate","rank":5}},{"type":"step","id":"REPAIR","attributes":{"id":"REPAIR","name":"REPAIR","label":"Repair","rank":6}},{"type":"step","id":"EXPERTISE","attributes":{"id":"EXPERTISE","name":"EXPERTISE","label":"Expertise","rank":7}},{"type":"step","id":"LOSS_SETTLEMENT","attributes":{"id":"LOSS_SETTLEMENT","name":"LOSS_SETTLEMENT","label":"Loss settlement","rank":8}},{"type":"step","id":"CLOSING","attributes":{"id":"CLOSING","name":"CLOSING","label":"Closing","rank":9}}],"links":{"self":{"href":"/app_dev.php/steps/v1/?access_token=Y2Y0YjdkZjA3OGFmOWIwZjQ2YTdhNjcyMmQzZTczNjkzY2ZkYzFjMDQ3NDBmZWI3YmIxMDczM2U3MDZkNTE3Nw"}},"jsonapi":{"version":"1.0"}}`;
	let body = JSON.parse(json);

	res.send(body);
});

/**
 * Get claim file summary
 * Real route : GET http://192.168.33.10:22201/app_dev.php/claimFiles/v1/summary/FR40P90000000?access_token=...
 */
app.get('/summary', (req, res) => {
	let json = `{"data":{"type":"summaryInformation","id":"FR40P90000000","attributes":{"summaryInformationClaim":{"name":"Claim","value":"4"},"summaryInformationCnt":{"name":"Insurance","value":""},"summaryInformationInsured":{"name":"Insured","value":"Mark"},"summaryInformationEvt":{"name":"Evt","value":null},"summaryInformationProduct":{"name":"Product","value":null},"summaryInformationDamage":{"name":"Damage","value":"2016-01-01 08:00:00"}}},"links":{"self":{"href":"\/app_dev.php\/claimFiles\/v1\/summary\/FR40P90000000?access_token=Yzg3YTdjZDcxNThjMTRmNzkwZDYxOGEyZmM2NTFhODVhZjM1NTMyMjRhYzY5OTFmOTM4ZjMxMmEyYzg2NzdmOQ"}},"jsonapi":{"version":"1.0"}}`;

	let body = JSON.parse(json);
	res.send(body);
});

// Homescreen : claimFile list
/* Serve homescreen page for react poke purpose
app.get('/claimFile/list', function(req, res){
	res.sendFile(path.resolve('client/claimHandler_home.html'));
});*/

app.listen(app.get('port'), function() {
  console.log('Server started: http://localhost:' + app.get('port') + '/');
});